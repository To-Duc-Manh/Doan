<%- include('headerUser.ejs') %>
    <div class="container" style="margin-top: 150px; margin-bottom: 150px">
        <table style="margin-top: 50px;" class="table table-PW table-striped table-hover table-borderless align-middle">
            <thead class="table-light">
                <caption>Danh sách sản phẩm có trong giỏ hàng </caption>
                <tr>
                    <th>STT</th>
                    <th></th>
                    <th></th>
                    <th></th>
                    <th></th>
                </tr>
            </thead>
            <tbody class="table-group-divider">
                <% if (cartItems && cartItems.length> 0) { %>
                    <% cartItems.forEach(function (item, index) { %>
                        <tr>
                            <td>
                                <%= index + 1 %>
                            </td>
                            <td>
                                <%= item.ten_san_pham %>
                            </td>
                            <td>
                                <%= item.mau_sac %>
                            </td>
                            <td>
                                <%= item.gia_ban %>
                            </td>
                            <td>
                                <%= item.so_luong %>
                            </td>
                            <td>
                                <input type="checkbox" name="selectedProducts" value="<%= item.id %>">
                            </td>
                            <td>
                                <div class="d-flex ">
                                    <a href="" class="btn btn-outline-success btn-sm mx-1">Sửa</a>
                                    <a href="" class="btn btn-outline-danger btn-sm mx-1">Xóa</a>
                                </div>
                            </td>
                        </tr>
                        <% }); %>
                            <% } else { %>
                                <tr>
                                    <td colspan="7">Không có dữ liệu</td>
                                </tr>
                                <% } %>

            </tbody>
        </table>

        <div class="row mt-5">
            <div class="col-lg-4">

            </div>
            <div class="col-lg-4"></div>
            <div class="col-lg-4">
                <p>TỔNG TIỀN</p>
                <hr>
                <p>Tổng tiền:</p>
                <p id="tong_tien_thanh_toan"></p>

                <button class="btn btn-primary" id="submitBtn">ĐẶT HÀNG</button>
            </div>
        </div>
    </div>

    <!-- truyền các id vào form rồi gửi đi -->
    <form id="productForm" hidden action="/submit_selected_products" method="POST">
        <input type="text" name="selectedProducts" id="selectedProducts" value="">
    </form>

    <script>
        document.addEventListener("DOMContentLoaded", function() {
            // Lắng nghe sự kiện khi người dùng nhấn vào nút "Đặt hàng"
            document.getElementById("submitBtn").addEventListener("click", function() {
                var selectedProducts = []; // Mảng chứa các ID của các sản phẩm đã chọn
    
                // Lặp qua tất cả các checkbox trong form
                var checkboxes = document.querySelectorAll('input[name="selectedProducts"]');
                checkboxes.forEach(function(checkbox) {
                    // Nếu checkbox được chọn, thêm ID của sản phẩm tương ứng vào mảng
                    if (checkbox.checked) {
                        selectedProducts.push(checkbox.value);
                    }
                });
    
                // Gắn các ID của các sản phẩm đã chọn vào input hidden trong form
                var input = document.getElementById("selectedProducts");
                input.value = selectedProducts.join(','); // Chuyển mảng thành chuỗi và gán vào input
    
                // Submit form
                document.getElementById("productForm").submit();
            });
        });
    </script>


    <!-- <script>
        document.getElementById('submitBtn').addEventListener('click', function () {
            var selectedProducts = [];
            var checkboxes = document.getElementsByName('selectedProducts');
            checkboxes.forEach(function (checkbox) {
                if (checkbox.checked) {
                    selectedProducts.push(checkbox.value);
                }
            });

            // Now 'selectedProducts' array contains the IDs of the selected products
            // You can send this array to the server using synchronous AJAX
            var xhr = new XMLHttpRequest();
            xhr.open('POST', '/submit_selected_products', false); // Đặt tham số cuối cùng là false để yêu cầu đồng bộ
            xhr.setRequestHeader('Content-Type', 'application/json');
            xhr.send(JSON.stringify({ selectedProducts: selectedProducts }));

            // Khi máy chủ gửi trang web 'user/dat_hang.ejs' như phản hồi, chúng ta có thể hiển thị trang web đó trực tiếp
            document.open(); // Xóa nội dung của trang hiện tại
            document.write(xhr.responseText); // Hiển thị trang web nhận được từ máy chủ
            document.close(); // Đóng tài liệu để ngăn việc viết thêm
        });
    </script> -->
    <%- include('footerUser.ejs') %>